#!/bin/sh
# Write/remove a task to do later.

todir="$XDG_DATA_HOME/todo"
load() {
	# count matches with grep vs line count
  	cd "$todir" || exit 1
	find ./ \! -path '*/\.*' \! -name 'singletask' -type f | while read -r title; do
		if ! test -s "$title"; then
			rm "$title"
			continue
		fi
		match="`grep -c "(x)" "$title"`"
		total="`wc -l "$title" | awk '{ print "100*'$match'/" $1 }' | bc`"
		printf '[%.2d%%]-%s\n' "$total" "`basename "$title"`"
	done
}

## Main
result="`load | dmenu -p "Select/create task" | cut -d '-' -f2-`"
test -z "$result" && exit 0

touch "$todir/$result"
#TODO: Use sane install directories
exec /usr/local/share/todo/singletask "$result"
